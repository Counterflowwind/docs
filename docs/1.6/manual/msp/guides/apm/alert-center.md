# 告警中心

erda中的告警提供了当用户配置的告警规则中的指标超出指定阈值时获取通知的方式。指标告警提供了一系列系统内置指标和可让用户自定义指标。
当用户需要在某个指标数据达到用户的阈值时用户可以在相关的通知渠道中收到具体的告警通知或者系统内置的告警规则无法满足用户需要时，可在告警
中心中配置告警策略和自定义告警规则来获取告警通知并查看告警通知历史。本文将介绍在告警中心中如何创建查看和管理指标告警规则和告警发送的通知组。

## 告警查看

### 告警总览

* **先决条件**：在查看告警总览时用户需要先配置好告警策略和通知组，并且达到了告警策略的触发条件发送通知后可在告警总览页中看到相应的数据及图表。

在告警总览也中分为4个卡片，每个卡片都显示了对应时间段内告警事件或者通知的数据图表，用户可以在右上角的时间选择器中选择期望的时间段获取对应时间段的
告警通知。

* 告警事件<br>
  该字段表示在选定时间内触发的告警时间的数量，即达到用户创建在告警策略中所设置的告警规则阈值的次数。<br>
* 恢复事件<br>
  该字段表示所触发的告警事件恢复的次数<br>
* 事件降噪<br>
  该字段表示多条告警合并成一条或者将告警根据级别合并的次数<br>
* 事件静默<br>
  在用户选择的时间段内告警事件的静默次数<br>
* 通知发送成功<br>
  该字段表示触发的告警事件发送到对应的通知组中的成功次数<br>
* 通知发送失败<br>
  该字段表示触发的告警事件发送都对应的通知组中的失败次数<br>
  
在告警总览页中的告警事件有两张曲线图，分别是按级别与按类别<br>
* 按级别<br>
  级别包含故障、严重、警告、提示，每一条曲线代表一种告警级别<br>
* 按类别<br>
  类别表示对应的类型模版，包含浏览器性能、应用错误、应用资源、微服务自定义、主动监控、微服务、应用事务。每一条曲线代表一个类别。<br>
告警持续事件分析气泡图展示了对应时间段内告警平均持续时间的触发的告警事件次数。

### 告警列表

在该页面中可以看到告警事件和通知发送的历史记录和详情。告警tab页表展示告警事件的历史记录，通知tab页展示了通知发送的历史记录。

#### 告警事件

事件的每一条记录都可以看到该事件的所属用户配置的告警策略，触发的次数、级别、状态、事件来源。

在左上角用户点击筛选器选择对应的筛选条件或这在搜索框中输入告警事件的部分名称可筛选出符合条件的告警事件。在右上角的设置按钮中用户可以选择希望看到的
告警事件的相关字段。例如，如果想看到事件来源该字段数据，就点击设置，将"事件来源"选上即可。

若是想看到触发的告警事件的详情可以点击该记录会跳转到事件的详情页，在详情页中可以看到该事件所属的告警策略，配置的告警规则关联对象等。关联对象可以看到触发该
告警事件的对象的详情，如host_ip、cluster_name等。

在监控数据图表中用户可以选择不同的时间段来查看该时间对应的告警规则中的指标数据，在右上角可以点击刷新刷新按钮查看最新数据，也可以选择时间间隔自动刷新
获取最新值。

事件历史中除了能看到触发时间，状态数据外还能看到触发值、持续时间、标签。

* 触发值<br>
该字段展示了该告警触发时告警规则中指标的具体数据，"()"中的是用户设置的告警规则的对应指标的阈值

* 持续时间<br>
该字段展示了该告警从开始触发到现在的持续时长，当告警恢复时，持续时间会被置0

* 标签<br>
该字段表示了告警触发时与该告警事件有关的其他值。如该告警所属的组织，告警的表达式id等

当用户想暂停或者屏蔽该事件的告警时可以在右上角 "更多操作" 中选择暂停告警或者屏蔽告警

* 暂停告警<br>
选择暂停告警之后会根据事件概览中的关联对象的键值对进行判断，当符合关联对象中的所有键值对后该告警将不会被触发。
在选择暂停告警后会要求用户选择暂停的截止时间，在时间到后会自动取消暂停告警，用户也可以在更多操作中选择取消暂停。

* 告警屏蔽<br>
选择告警屏蔽之后会根据关联对象中的键值对进行判断，当符合关联对象所有的键值对后该事件的告警还是会触发，但是用户将
不会再收到该告警的通知，在选择屏蔽告警时不会要求用户选择暂停屏蔽的时间，当用户想要停止告警屏蔽时想要手动在更多操作中选择取消屏蔽。

#### 告警通知

在通知tab页中筛选与搜索的操作相同具体可以参考告警事件中的筛选和搜索操作。在通知页面中展示了每一条通知记录的状态、通知渠道等信息。点击具体的记录
可以跳转到该通知的详情页，在详情页中可以看到该通知绑定的通知组名称，关联的告警规则等信息。在通知内容中可以看到该通知的具体信息，每一条
告警规则由于其设置的模版不一样，不同告警规则触发的通知内容展示不同。用户会看到一条或者多条的通知详情，多条是避免通知发送过于频繁，将时间段
内要发送的多条通知进行聚合，合并成一条通知将其发送到通知组。

### 告警配置

用户可以配置具体的告警策略，设置告警规则阈值，获取告警通知

1. 点击告警策略，在告警策略tab页中点击 "新建策略"
2. 在 "告警名称" 输入框中输入用户自定义的告警策略名称
3. 如果用户需要对某些特定的条件进行告警，可以在 "过滤规则" 中添加过滤条件，告警时会根据符合过滤条件的对应指标数据进行告警，
若不添加过滤条件，则是针对对应指标的所有数据进行规则匹配。
    * 多云管理<br>
    多云管理中的过滤规则可选择的标签为集群名、主机ip和平台组件
    
    * 微服务治理<br>
    微服务治理中的过滤规则可选择的标签为应用名和服务名
   
4. 添加告警规则。用户可以通过点击 "类型模版" 添加对应类型下的所有告警规则，也可以点击 "添加规则" 逐条添加告警规则
5. 用户可以根据自身需要修改规则中指标的默认值
    * 持续周期<br>
      用户所选择的的时间段中所触发的告警，单位分钟<br>
    * 告警级别<br>
      用户可以判断告警的严重程度选择告警级别，每条规则会带有默认的告警级别，用户也可以设置为故障、严重、警告、提示，级别逐级递减<br>
    * 触发恢复<br>
    用户可以根据需要选择是否在对应的告警规则恢复时发送告警恢复的通知。部分规则和自定义规则不支持触发恢复<br>
6. 选择沉默周期，该字段表示下一次发送该告警策略对应的通知与上一次的时间间隔<br>
7. 选择沉默周期策略，默认为固定，表示每次相隔的时间间隔为用户选择的沉默周期，翻倍表示下一次的触发时间间隔为前一次的时间间隔的双倍<br>
8. 选择通知到的对象，该群组就是用户事先创建好的通知组，根据对应的通知组通知到的不同，可以选择一种或者多种的通知方式，
当只有通知组中的级别包含告警规则的级别时，该告警通知才能发送到该通知组中，用户也可以添加多个不同的通知组<br>

具体告警策略配置如图所示：
![](http://terminus-paas.oss-cn-hangzhou.aliyuncs.com/paas-doc/2022/03/04/64a91dba-71dd-447f-9e1a-d6194f7bbdd5.png)

### 自定义告警

用户可根据自身需要配置指标告警规则的指标数据和告警模版

1. 在自定义告警tab页中点击 "创建自定义规则" 
2. 在 "名称" 输入框中输入用户自定义的告警规则的名称
3. 在 "周期" 输入框中输入用户希望指标聚合产生结果的事件，单位为分钟
4. 在 "指标" 下拉框中选择指标
5. 在 "通知方式" 中选择该自定义告警规则允许的通知方式，生成对应通知方式的模版。可选择钉钉、邮箱、站内信、短信等多种通知方式
6. 在 "消息标题规则" 中用户自定义告警发送的消息标题模版
7. 在 "消息内容规则" 中用户自定义告警发送的消息内容模版
在消息标题和消息内容中可用花括号引用对应指标的字段，例如{{project_name}},可引用的字段包括project_name、application_name、runtime_name、service_name、host_ip、cluster_name 等。

![](http://terminus-paas.oss-cn-hangzhou.aliyuncs.com/paas-doc/2022/03/04/3eabf82c-fb07-40e4-9426-714b2ed7163f.png)

完成自定义告警配置，即定义了一个告警规则的模版，用户可以在告警策略中选择已定义的告警规则模版，关联通知组等，进一步配置具体信息，完成配置之后
若对应指标满足配置条件则可以触发告警，根据自定义的消息内容模版发出对应的告警通知。

## 通知组管理

用户定义通知组，告警通知发送时绑定接收的通知组，在微服务治理中，通知组管理在告警中心的 "告警配置" 页中。在多云管理平台中，通知组的管理在 "管理中心" -> "组织设置" -> "通知组" 中

1. 点击 "新建通知组"
2. 用户自定义群组名称
3. 点击 "通知到" 在下拉框中选择通知到的对象
4. 根据不同的通知到对象填写具体的通知信息

具体操作如图所示：

![](http://terminus-paas.oss-cn-hangzhou.aliyuncs.com/paas-doc/2022/03/04/148cd747-18a9-4252-9282-b55691fbebb5.png)

用户创建好通知组后可在告警策略中引用该通知组，当触发告警时，该通知组会收到对应告警策略发送的告警通知消息。

